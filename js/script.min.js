function initForm(){return"FormData"in window?void form.addEventListener("submit",function(e){e.preventDefault();var t=new FormData(form),r=[];r.forEach(function(e){t.append("form-review__photos-gallery",e.file)}),request(t,function(e){console.log(e)})}):void console.warn("У вас нет пожжержки FormData в браузере")}function request(e,t){var r=new XMLHttpRequest,n=(new Date).getTime();r.open("post","http://simonenko.su/academy/echo?"+n),r.addEventListener("readystatechange",function(){4==r.readyState?(t(r.responseText),done.classList.add("popup-show"),btn_popup.addEventListener("click",function(){event.preventDefault(),console.info("close popup"),done.classList.remove("popup-show")})):(fail.classList.add("popup-show"),btn_popup.addEventListener("click",function(){event.preventDefault(),console.info("close popup"),fail.classList.remove("popup-show")}))}),r.send(e)}function initLocalStorage(){if(window.localStorage)for(var e=document.querySelector(".form-review__form"),t=e.querySelectorAll("[name]")-1,r=0;r<t.length;r++)getState(t[r]),setState(t[r])}function getState(e){var t=e.getAttribute("name");e.value=localStorage.getItem(t)||""}function setState(e){var t=e.getAttribute("name");e.addEventListener("keyup",function(){var e=this.value;e||(e=""),localStorage.setItem(t,e)})}function diffDate(){var e=new Date(arrival.value).getTime(),t=new Date(depart.value).getTime(),r=Math.floor((t-e)/1e3/60/60/24);0>r?trip_duration.value=0:(trip_duration.value=r,console.log(trip_duration.value))}function plusDate(e){if(!arrival.value){date=new Date;var t=(date.getMonth()+1).toString(),t=t[1]?t:"0"+t[0],r=date.getDate().toString();console.info("Day1: "+r);var r=r[1]?r:"0"+r[0];arrival.value=date.getFullYear()+"-"+t+"-"+r,arrival.addEventListener("change",function(){plusDate(trip_duration.value),depart.addEventListener("change",function(){diffDate()})})}var n=new Date(arrival.value).getTime();console.log("Дата в первом инпуте: "+new Date(n));var a=Math.floor(1e3*e*60*60*24+n),o=new Date(a);console.warn("Дата в втором инпуте: "+o);var t=(o.getMonth()+1).toString(),t=t[1]?t:"0"+t[0],r=o.getDate().toString();console.info("Day1: "+r);var r=r[1]?r:"0"+r[0];console.info("Month: "+t),console.info("Day2: "+r),depart.value=o.getFullYear()+"-"+t+"-"+r}function changeNumbers(e,t){parseInt(t.value)+e<1?console.warn("Слишком мало!"):parseInt(t.value)+e>=1&&parseInt(t.value)+e<=30?(t.value||(t.value=1),t.value=parseInt(t.value)+e):console.warn("Слишком много!")}function removeTraveler(){var e=form.querySelector(".form-review__travelers-data .form-wrapper"),t=document.getElementById("traveler"+(parseInt(number_traveler.value)+1));e.removeChild(t),console.log("Путешественник удален!")}function addTraveler(){var e=(document.querySelector(".form-review__travelers-data"),document.querySelector(".form-review__travelers-data .form-wrapper")),t=document.querySelector("#traveler_template").innerHTML,r=Mustache.render(t,{number:number_traveler.value}),n=document.createElement("div");n.classList.add("form-review__traveler"),n.id="traveler"+number_traveler.value,n.innerHTML=r,e.appendChild(n),console.log("Добавлен путешественник!")}function preview(e){if("FileReader"in window&&e.type.match(/image.*/)){var t=new FileReader;t.addEventListener("load",function(t){var r=(document.querySelector(".form-review__form"),document.querySelector(".form-review__photos-gallery")),n=document.querySelector("#image_template").innerHTML,a=[],o=Mustache.render(n,{image:t.target.result,name:e.name}),l=document.createElement("figure");l.innerHTML=o,r.appendChild(l),console.info("Фотография добавлена!");var u=l.querySelector(".form-review__photo-close");u.addEventListener("click",function(e){e.preventDefault(),removePreview(l)}),a.push({file:e,figure:l})}),t.readAsDataURL(e)}}function removePreview(e){var t=[];t=t.filter(function(t){return t.figure!=e}),e.parentNode.removeChild(e),console.info("Фотография удалена!")}var menu=document.querySelector(".main-menu__btn-menu"),nav=document.querySelectorAll(".main-menu__item"),cross=document.querySelector(".main-menu__cross"),form=document.querySelector(".form-review__form"),done=document.querySelector(".popup--request"),fail=document.querySelector(".popup--failure"),btn_popup=document.querySelectorAll(".popup__btn"),handler=function(){event.preventDefault();for(var e=0;e<nav.length;e++)nav[e].classList.toggle("main-menu__item--show");cross.classList.toggle("main-menu__cross--show")};menu.addEventListener("click",handler),menu.addEventListener("tap",handler),cross.addEventListener("click",handler),cross.addEventListener("tap",handler),initForm(),initLocalStorage();var trip_duration=document.getElementById("trip-duration"),btn_minus=document.querySelector(".form-review__counter-trip > .form-review__btn-minus"),btn_plus=document.querySelector(".form-review__counter-trip > .form-review__btn-plus");btn_minus.addEventListener("click",function(e){e.preventDefault(),changeNumbers(-1,trip_duration),console.info("Минус день"+trip_duration.value),plusDate(trip_duration.value)}),btn_plus.addEventListener("click",function(e){e.preventDefault(),changeNumbers(1,trip_duration),console.info("Плюс день"+trip_duration.value),plusDate(trip_duration.value)});var del_traveler=document.querySelector(".form-review__number-travelers > .form-review__btn-minus"),add_traveler=document.querySelector(".form-review__number-travelers > .form-review__btn-plus"),number_traveler=document.getElementById("number_traveler");del_traveler.addEventListener("click",function(e){e.preventDefault(),changeNumbers(-1,number_traveler),console.info("Больше путешественников, больше!"+number_traveler.value),removeTraveler()}),add_traveler.addEventListener("click",function(e){e.preventDefault(),changeNumbers(1,number_traveler),console.info("Меньше путешественников,меньше!"+number_traveler.value),addTraveler()});var btn_upload=document.querySelector("#upload_photo");btn_upload.addEventListener("change",function(){for(var e=this.files,t=0;t<e.length;t++)preview(e[t]);this.value=""});